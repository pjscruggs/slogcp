name: Update License Year

on:
  schedule:
    - cron: '0 0 2 1 *' # Run on January 2nd each year
  workflow_dispatch:

# Need write permissions to create commits
permissions:
  contents: write

jobs:
  update-year:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Get current year in US Central Time
        id: year
        run: |
          # Get current year in US Central Time
          YEAR=$(TZ='America/Chicago' date +%Y)
          echo "YEAR=$YEAR" >> $GITHUB_OUTPUT
      
      - name: Update license year in config
        run: |
          # Only update if year is after 2025
          if [ "${{ steps.year.outputs.YEAR }}" -gt "2025" ]; then
            sed -i 's/copyright-year: .*/copyright-year: "2025-${{ steps.year.outputs.YEAR }}"/g' .licenserc.yaml
            echo "Updated year to 2025-${{ steps.year.outputs.YEAR }}"
          else
            echo "Keeping year as 2025"
          fi
      
      - name: Commit config change
        uses: EndBug/add-and-commit@v9
        with:
          author_name: License Year Bot
          author_email: license-bot@github.com
          message: 'chore: Update license year to 2025-${{ steps.year.outputs.YEAR }}'
          add: '.licenserc.yaml'
      
      - name: Run license header fix
        uses: apache/skywalking-eyes/header@v0.5.0
        with:
          mode: fix
          config: .licenserc.yaml
      
      - name: Commit header updates
        uses: EndBug/add-and-commit@v9
        with:
          author_name: License Bot
          author_email: license-bot@github.com
          message: 'chore: Apply updated license year to all files'
          add: '.'