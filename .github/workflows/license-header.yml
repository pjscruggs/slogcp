name: 🛡️ License Header Management

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  merge_group:
    types: [ checks_requested ]
  workflow_dispatch:
  workflow_call:

# Enable write to commit fixes
permissions:
  contents: write

jobs:
  license-header:
    name: 🛡️ Apply License Headers
    runs-on: ubuntu-latest
    steps:
      - name: 🔄 Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          fetch-depth: 0  # Full history for proper file dating

      - name: 🛠️ Fix License Headers
        id: fix-license
        uses: apache/skywalking-eyes/header@5c5b974209f0de5d905f37deb69369068ebfc15c # v0.7.0
        with:
          mode: fix
          config: .licenserc.yaml
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 💾 Commit header fixes
        uses: EndBug/add-and-commit@a94899bca583c204427a224a7af87c02f9b325d5 # v9
        with:
          author_name: "License Bot"
          author_email: "license-bot@github.com"
          message: "chore: apply license header fixes"
          add: "."