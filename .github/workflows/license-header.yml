name: License Header Management

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  merge_group:
    types: [ checks_requested ]
  workflow_dispatch:
  workflow_call:

# Enable write to commit fixes
permissions:
  contents: write

jobs:
  license-header:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for proper file dating

      - name: Fix License Headers
        id: fix-license
        uses: apache/skywalking-eyes/header@v0.7.0
        with:
          mode: fix
          config: .licenserc.yaml
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Commit header fixes
        if: steps.fix-license.outputs.fixed_files != ''
        uses: EndBug/add-and-commit@v9
        with:
          author_name: "License Bot"
          author_email: "license-bot@github.com"
          message: "chore: apply license header fixes"
          add: "."